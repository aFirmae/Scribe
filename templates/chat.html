<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Room - Scribe</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c4b5fd;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a78bfa;
        }

        /* Message animations */
        .message-enter {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile sidebar */
        .sidebar-mobile {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .sidebar-mobile.open {
            transform: translateX(0);
        }

        /* Textarea auto-grow */
        .message-input {
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }
    </style>
</head>

<body class="bg-gray-50 h-screen overflow-hidden">

    <!-- Mobile Menu Toggle -->
    <button id="mobileMenuBtn"
        class="lg:hidden fixed top-4 left-4 z-50 bg-white p-3 rounded-full shadow-lg text-indigo-600 hover:bg-indigo-50 transition-colors">
        <i class="fas fa-bars text-xl"></i>
    </button>

    <!-- Main Container -->
    <div class="flex h-screen">

        <!-- Sidebar - Desktop: static, Mobile: overlay -->
        <div id="sidebar"
            class="sidebar-mobile lg:translate-x-0 fixed lg:static inset-y-0 left-0 z-40 w-80 bg-white border-r border-gray-200 flex flex-col">

            <!-- Sidebar Header -->
            <div class="gradient-bg p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-comments text-2xl"></i>
                        <span class="text-xl font-bold">Scribe</span>
                    </div>
                    <button id="closeSidebarBtn" class="lg:hidden text-white/80 hover:text-white">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Room Name -->
                <div class="flex items-center justify-between">
                    <h2 id="roomName" class="text-xl font-semibold truncate flex-1"></h2>
                    <button id="editRoomNameBtn" class="hidden ml-2 text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>

            <!-- Room Code Section -->
            <div class="p-4 bg-indigo-50 border-b border-indigo-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs text-gray-600 mb-1">Room Code</p>
                        <div class="flex items-center space-x-2">
                            <span id="roomCode" class="text-xl font-bold text-indigo-600 tracking-wider"></span>
                            <button id="copyCodeBtn" class="text-indigo-600 hover:text-indigo-700 transition-colors"
                                title="Copy code">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <button id="toggleCodeBtn" class="hidden text-gray-600 hover:text-gray-700 transition-colors"
                        title="Toggle code visibility">
                        <i id="codeVisibilityIcon" class="fas fa-eye text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- User List -->
            <div class="flex-1 overflow-y-auto custom-scrollbar p-4">
                <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wider">
                    Participants (<span id="userCount">0</span>/5)
                </h3>
                <div id="userList" class="space-y-2">
                    <!-- Users will be inserted here -->
                </div>
            </div>

            <!-- Host Actions -->
            <div id="hostActions" class="hidden p-4 border-t border-gray-200">
                <button id="deleteRoomBtn"
                    class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2.5 rounded-lg transition-colors flex items-center justify-center space-x-2">
                    <i class="fas fa-trash"></i>
                    <span>Delete Room</span>
                </button>
            </div>

            <!-- Leave Room Button -->
            <div class="p-4 border-t border-gray-200">
                <a href="/"
                    class="block w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2.5 rounded-lg transition-colors text-center">
                    <i class="fas fa-sign-out-alt mr-2"></i>Leave Room
                </a>
            </div>
        </div>

        <!-- Mobile Sidebar Overlay -->
        <div id="sidebarOverlay" class="lg:hidden hidden fixed inset-0 bg-black/50 z-30"></div>

        <!-- Main Chat Area -->
        <div class="flex-1 flex flex-col h-screen">

            <!-- Chat Header (Mobile only) -->
            <div class="lg:hidden gradient-bg text-white p-4 pl-16">
                <h2 id="roomNameMobile" class="text-lg font-semibold truncate"></h2>
                <p class="text-sm text-white/80">
                    <span id="userCountMobile">0</span> participants
                </p>
            </div>

            <!-- Messages Container -->
            <div id="messagesContainer" class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4 bg-gray-50">
                <!-- Messages will be inserted here -->
            </div>

            <!-- Message Input -->
            <div class="bg-white border-t border-gray-200 p-4">
                <form id="messageForm" class="flex items-end space-x-3">
                    <div class="flex-1 relative">
                        <textarea id="messageInput" placeholder="Type your message..."
                            class="message-input w-full px-4 py-3 pr-12 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none resize-none"
                            rows="1"></textarea>
                    </div>
                    <button type="submit"
                        class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-3 rounded-full hover:shadow-lg transition-all flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed"
                        id="sendBtn">
                        <i class="fas fa-paper-plane text-lg"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Room Name Modal -->
    <div id="editRoomModal"
        class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Edit Room Name</h3>
            <form id="editRoomForm">
                <input type="text" id="newRoomName" maxlength="50" placeholder="Enter new room name"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none mb-4">
                <div class="flex space-x-3">
                    <button type="button" onclick="closeEditRoomModal()"
                        class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2.5 rounded-xl transition-colors">
                        Cancel
                    </button>
                    <button type="submit"
                        class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-2.5 rounded-xl hover:shadow-lg transition-all">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let socket;
        let roomCode = '{{ room_code }}';
        let username = '';
        let isHost = false;
        let isCodeVisible = true;

        // Get username from URL params
        const urlParams = new URLSearchParams(window.location.search);
        username = urlParams.get('username') || prompt('Enter your username:');

        if (!username) {
            window.location.href = '/';
        }

        // Initialize Socket.IO
        socket = io();

        // Mobile sidebar toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.add('open');
            document.getElementById('sidebarOverlay').classList.remove('hidden');
        });

        document.getElementById('closeSidebarBtn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.add('hidden');
        });

        document.getElementById('sidebarOverlay').addEventListener('click', () => {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.add('hidden');
        });

        // Auto-grow textarea
        const messageInput = document.getElementById('messageInput');
        messageInput.addEventListener('input', function () {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Handle Enter key (send message) and Shift+Enter (new line)
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.getElementById('messageForm').dispatchEvent(new Event('submit'));
            }
        });

        // Socket event handlers will be added in the next file
        // (This is a placeholder - the actual implementation will be in the JavaScript file)
    </script>

    <!-- Load chat functionality -->
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>

</html>